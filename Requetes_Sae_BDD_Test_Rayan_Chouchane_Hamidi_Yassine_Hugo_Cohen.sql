/* -----------------------------------------------------------------------
Requetes Test BDD : Sae_BDD
Version : 1.0
Auteur : Rayan Chouchane, Hamidi Yassine, Hugo Cohen
Date création : 24/03/2022
------------------------------------------------------------------------- */


-----------------------Extraction des Données----------------------------------

select *
from  Criteres ;

/*
1	"hosp_patients"
2	"new_tests"
3	"total_tests"
4	"total_cases_per_million"
5	"new_cases_per_million"
6	"new_cases_smoothed_per_million"
7	"new_cases_smoothed"
8	"new_cases"
9	"total_cases"
*/


select *
from  Continents ;

/*
"EU"	"Europe"
"AS"	"Asie"
*/

select *
from  Pays ;

/*
"ALB"	"Albania"	3088385.00	"EU"
"AND"	"Andora"	77265.00	"EU"
"AUT"	"Austria"	8859449.00	"EU"
"FRA"	"France"	68014000.00	"EU"
"RUS"	"Russia"	146170015.00	"EU"
"YEM"	"Yemen"	29830000.00	"AS"
"JAP"	"Japon"	125800000.00	"AS"
"CH "	"Chine"	1402000000.00	"AS"
"HUN"	"Hongrie"	9634162.00	"EU"
"ARM"	"Armenie"	2963000.00	"AS"
*/


select *
from  CriterePays ;
/*
"HUN"	1	"2021-01-01"	5648
"HUN"	1	"2021-01-02"	5529
"HUN"	1	"2021-01-03"	5619
"HUN"	1	"2021-01-04"	5667
"HUN"	1	"2021-01-05"	5760
"HUN"	1	"2021-01-06"	5646
"HUN"	1	"2021-01-07"	5387
*/

select *
from  CritereContinent ;
/*
"EU"	4	"2021-01-01"	32162.772
"EU"	4	"2021-01-02"	32375.966
"EU"	4	"2021-01-03"	32601.125
"EU"	4	"2021-01-04"	32873.167
"EU"	4	"2021-01-05"	33250.996
"EU"	4	"2021-01-06"	33618.739
"EU"	4	"2021-01-07"	34048.27
"EU"	4	"2021-01-08"	34422.074
"EU"	4	"2021-01-09"	34731.34
*/


-----------------------Moyenne des Données----------------------------------

select Iso_Pays ,AVG (Valeur) 
from CriterePays  
group by (Iso_Pays);
/*
"ARM"	49115.293837398374
"AUT"	14793.836577235772
"HUN"	855789.276422764228
"JAP"	36300.881569105691
"ALB"	8444.5606910569105691
"AND"	40538.277365853659
"YEM"	705.4552764227642276
"RUS"	8309.0768536585365854
"FRA"	15184.294073170732
"CH "	28701.462268292683
*/


--Somme des valeurs des critères pour chaque Pays ayant le critères  4 ou 9
select CriterePays.Iso_Pays , Criteres.Nom_Critere, SUM (Valeur) 
from CriterePays join Criteres using(Id_Critere) 
where CriterePays.Id_Critere=4 or  CriterePays.Id_Critere=9  
group by (Criteres.Nom_Critere,CriterePays.Iso_Pays);

/*
isoPays     Nom_Critere             Sum
"RUS"	"total_cases_per_million"	1010247.382
"FRA"	"total_cases_per_million"	1845127.510
"AND"	"total_cases_per_million"	4925278.586
"JAP"	"total_cases"	4372993
"AUT"	"total_cases_per_million"	1804568.845
"ARM"	"total_cases"	5972195
"CH "	"total_cases"	3528589
"YEM"	"total_cases"	86700
"ALB"	"total_cases_per_million"	1018172.015
*/


--pour compter le nombre d’enregistrement pour un critères données et un pays
select CriterePays.Iso_Pays , Criteres.Nom_Critere, Count (Valeur) 
from CriterePays join Criteres using(Id_Critere)  
group by (Criteres.Nom_Critere,CriterePays.Iso_Pays);
/*
"RUS"	"total_cases_per_million"	41
"ARM"	"new_cases"	41
"AND"	"new_cases_smoothed_per_million"	41
"ALB"	"new_cases_per_million"	41
"HUN"	"total_tests"	41
"RUS"	"new_cases_smoothed_per_million"	41
"AND"	"new_cases_per_million"	41
"YEM"	"new_cases"	41
"FRA"	"total_cases_per_million"	41
"YEM"	"new_cases_smoothed"	41
"FRA"	"new_cases_smoothed_per_million"	41
"HUN"	"hosp_patients"	41
"ARM"	"new_cases_smoothed"	41
"CH "	"total_cases"	41
"CH "	"new_cases_smoothed"	41
"FRA"	"new_cases_per_million"	41
"YEM"	"total_cases"	41
"JAP"	"total_cases"	41
"JAP"	"new_cases_smoothed"	41
"AUT"	"new_cases_smoothed_per_million"	41
"ARM"	"total_cases"	41
"CH "	"new_cases"	41
"ALB"	"total_cases_per_million"	41
"AND"	"total_cases_per_million"	41
"RUS"	"new_cases_per_million"	41
"ALB"	"new_cases_smoothed_per_million"	41
"AUT"	"total_cases_per_million"	41
"JAP"	"new_cases"	41
"AUT"	"new_cases_per_million"	41
"HUN"	"new_tests"	41
*/



----Donne la ou les  valeurs les plus petites pour un critère donné avec sa date 
select   cp1.Iso_Pays , c1.Nom_Critere, MIN (Valeur) , cp1.Date_Valeur
from CriterePays cp1 join Criteres c1 using(Id_Critere) 
group by (c1.Nom_Critere,cp1.Iso_Pays ,cp1.Date_Valeur)
having MIN (Valeur) =
(
	select 	MIN (Valeur) 
	from  CriterePays cp2 join Criteres c2 using(Id_Critere) 
	group by (c2.Nom_Critere,cp2.Iso_Pays )
	having(c2.Nom_Critere = c1.Nom_Critere )
	and  (cp2.Iso_Pays = cp1.Iso_Pays )

)
order by cp1.iso_pays;

/*
iso_Pays    nom_critere         min     date_Valeur
"ALB"	"new_cases_per_million"	0	"2021-01-01"
"ALB"	"new_cases_smoothed_per_million"	145.993	"2021-01-01"
"ALB"	"total_cases_per_million"	20298.413	"2021-01-01"
"AND"	"new_cases_per_million"	520.797	"2021-02-10"
"AND"	"new_cases_smoothed_per_million"	520.797	"2021-02-10"
"AND"	"total_cases_per_million"	104933.164	"2021-01-01"
"ARM"	"new_cases"	114	"2021-02-06"
"ARM"	"new_cases_smoothed"	313.286	"2021-02-08"
"ARM"	"total_cases"	126224	"2021-01-01"
"AUT"	"new_cases_per_million"	111.577	"2021-01-25"
"AUT"	"new_cases_smoothed_per_million"	146.584	"2021-02-10"
"AUT"	"total_cases_per_million"	40131.385	"2021-01-01"
"CH "	"new_cases"	5	"2021-02-10"
"CH "	"new_cases_smoothed"	11.714	"2021-02-01"
"CH "	"total_cases"	85622	"2021-01-01"
"FRA"	"new_cases_per_million"	0	"2021-02-04"
"FRA"	"new_cases_smoothed_per_million"	195.055	"2021-01-01"
"FRA"	"total_cases_per_million"	39750.141	"2021-01-01"
"HUN"	"hosp_patients"	3562	"2021-01-31"
"HUN"	"new_tests"	5130	"2021-01-19"
"HUN"	"total_tests"	2245155	"2021-01-01"
"JAP"	"new_cases"	316	"2021-01-05"
"JAP"	"new_cases_smoothed"	531.429	"2021-01-04"
"JAP"	"total_cases"	90685	"2021-01-01"
"RUS"	"new_cases_per_million"	97.716	"2021-02-10"
"RUS"	"new_cases_smoothed_per_million"	107.561	"2021-02-10"
"RUS"	"total_cases_per_million"	21615.491	"2021-01-01"
"YEM"	"new_cases"	0	"2021-01-02"
"YEM"	"new_cases"	0	"2021-01-03"
"YEM"	"new_cases"	0	"2021-01-04"
"YEM"	"new_cases"	0	"2021-01-05"
"YEM"	"new_cases"	0	"2021-01-08"
"YEM"	"new_cases"	0	"2021-01-09"
"YEM"	"new_cases"	0	"2021-01-10"
"YEM"	"new_cases"	0	"2021-01-17"
"YEM"	"new_cases"	0	"2021-01-20"
"YEM"	"new_cases"	0	"2021-01-21"
"YEM"	"new_cases"	0	"2021-01-23"
"YEM"	"new_cases"	0	"2021-01-24"
"YEM"	"new_cases"	0	"2021-01-25"
"YEM"	"new_cases"	0	"2021-01-28"
"YEM"	"new_cases"	0	"2021-01-29"
"YEM"	"new_cases"	0	"2021-01-30"
"YEM"	"new_cases"	0	"2021-02-02"
"YEM"	"new_cases"	0	"2021-02-03"
"YEM"	"new_cases"	0	"2021-02-04"
"YEM"	"new_cases"	0	"2021-02-07"
"YEM"	"new_cases"	0	"2021-02-09"
"YEM"	"new_cases_smoothed"	0.286	"2021-01-24"
"YEM"	"new_cases_smoothed"	0.286	"2021-01-25"
"YEM"	"new_cases_smoothed"	0.286	"2021-01-29"
"YEM"	"new_cases_smoothed"	0.286	"2021-01-30"
"YEM"	"total_cases"	2101	"2021-01-01"
"YEM"	"total_cases"	2101	"2021-01-02"
"YEM"	"total_cases"	2101	"2021-01-03"
"YEM"	"total_cases"	2101	"2021-01-04"
"YEM"	"total_cases"	2101	"2021-01-05"
*/